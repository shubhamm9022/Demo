<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Watch Movie</title>
  <style>
    body {
      background-color: #0e0e0e;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }
    header {
      text-align: center;
      padding: 20px;
    }
    header img {
      width: 150px;
    }
    .movie-title {
      text-align: center;
      font-size: 1.8rem;
      margin-bottom: 10px;
    }
    .sheet-name {
      text-align: center;
      font-size: 0.85rem;
      color: #888;
      margin-bottom: 20px;
    }
    .player-container {
      width: 100%;
      max-width: 800px;
      height: 480px;
      margin: auto;
      background-color: #000;
      position: relative;
    }
    .player-container iframe {
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      display: none;
    }
    .server-buttons {
      text-align: center;
      margin: 20px 0;
    }
    .server-buttons button {
      background-color: #1c1c1c;
      color: #fff;
      border: none;
      padding: 10px 20px;
      margin: 0 10px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
      transition: 0.3s;
    }
    .server-buttons button:hover {
      background-color: #444;
    }
    footer {
      text-align: center;
      font-size: 0.9rem;
      padding: 20px;
      color: #aaa;
      background-color: #111;
    }
    footer a {
      color: #aaa;
      text-decoration: none;
    }
    footer a:hover {
      text-decoration: underline;
    }
  </style>

  <script>
    // Asset Protection
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.onkeydown = function (e) {
      if (e.keyCode == 123 || (e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74))) {
        return false;
      }
    };

    // Session Timer (10 hours limit)
    window.onload = function () {
      const firstVisit = localStorage.getItem('visit_time');
      if (!firstVisit) {
        localStorage.setItem('visit_time', Date.now());
      } else {
        const now = Date.now();
        if (now - parseInt(firstVisit) > 36000000) {
          localStorage.removeItem('visit_time');
          alert("Session expired. Please refresh or visit again.");
          window.location.href = '/';
          return;
        }
      }

      // Get ?movie=MovieName from URL
      const urlParams = new URLSearchParams(window.location.search);
      const movie = urlParams.get('movie');

      if (movie) {
        fetch(`https://opensheet.elk.sh/1oDtwyGB7ArzmWtP81I2QeBNXAiEefgTOepAHqwRfNZs/Sheet2`)
          .then(res => res.json())
          .then(data => {
            const match = data.find(row => row["Movie name"]?.toLowerCase().trim() === movie.toLowerCase().trim());
            if (match) {
              document.getElementById('movieTitle').innerText = match["Movie name"];
              document.getElementById('sheetName').innerText = "From Sheet2";
              loadPlayer(match["Server 1"], match["Server 2"]);
            } else {
              showError();
            }
          })
          .catch(err => {
            console.error(err);
            showError();
          });
      } else {
        showError();
      }
    };

    function showError() {
      document.getElementById('movieTitle').innerText = "Movie Not Found";
      document.querySelector('.player-container').innerHTML = "<p style='text-align:center; padding: 40px;'>Movie not available.</p>";
      document.querySelector('.server-buttons').style.display = "none";
    }

    function loadPlayer(server1, server2) {
      const p1 = document.getElementById('player1');
      const p2 = document.getElementById('player2');

      p1.src = server1;
      p2.src = server2;

      p1.style.display = "block"; // Show default
    }

    function switchServer(playerId) {
      document.getElementById('player1').style.display = 'none';
      document.getElementById('player2').style.display = 'none';
      document.getElementById(playerId).style.display = 'block';
    }
  </script>
</head>

<body>
  <header>
    <img src="/assets/logo.png" alt="Logo" />
  </header>

  <div class="movie-title" id="movieTitle">Loading...</div>
  <div class="sheet-name" id="sheetName"></div>

  <div class="player-container">
    <iframe id="player1" allowfullscreen allowtransparency allow="autoplay" scrolling="no" frameborder="0"></iframe>
    <iframe id="player2" allowfullscreen allowtransparency allow="autoplay" scrolling="no" frameborder="0"></iframe>
  </div>

  <div class="server-buttons">
    <button onclick="switchServer('player1')">Server 1</button>
    <button onclick="switchServer('player2')">Server 2</button>
  </div>

  <footer>
    <p><a href="/request-removal.html">Request Removal</a> | &copy; 2025 MoviesVault. All rights reserved.</p>
  </footer>
</body>
</html>
