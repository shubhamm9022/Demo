<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Details</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <div class="logo-container">
            <a href="index.html"><img src="logo.png" alt="MoviesVault.HQ Logo" class="logo"></a>
        </div>
    </header>
    
    <section id="movie-details">
        <!-- Skeleton loading -->
        <div class="skeleton skeleton-poster-large"></div>
        <div class="movie-info">
            <div class="skeleton skeleton-text" style="width:70%; height:2.5rem;"></div>
            <div class="skeleton skeleton-text" style="width:50%;"></div>
            <div class="skeleton skeleton-text" style="width:60%;"></div>
            <div class="skeleton skeleton-text" style="height:8rem;"></div>
            <div class="buttons">
                <div class="skeleton skeleton-text" style="width:120px; height:45px;"></div>
                <div class="skeleton skeleton-text" style="width:120px; height:45px;"></div>
            </div>
        </div>
    </section>
    
    <footer>
        <p>&copy; 2025 Movie Vault. All Rights Reserved.</p>
        <nav class="footer-nav">
            <a href="dmca.html">DMCA</a>
            <a href="request.html">Request</a>
            <a href="how-to-download.html">How to Download</a>
            <a href="contact.html">Contact</a>
        </nav>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const supabaseUrl = 'https://tymkbfpmbgrdxgvqpgzo.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR5bWtiZnBtYmdyZHhndnFwZ3pvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM4MjQyOTYsImV4cCI6MjA1OTQwMDI5Nn0.9ZT2oHJn-QYBNk8KWEbM25UVtz5W1-fcnRehVADyx7o';
            const supabase = supabase.createClient(supabaseUrl, supabaseKey);

            const urlParams = new URLSearchParams(window.location.search);
            const movieId = urlParams.get("id");

            if (!movieId) {
                showError("Movie ID not found in URL");
                return;
            }

            async function fetchMovieDetails() {
                try {
                    let { data: movie, error } = await supabase
                        .from('movies')
                        .select('*')
                        .eq('id', movieId)
                        .single();

                    if (error) throw error;
                    if (!movie) throw new Error("Movie not found");

                    renderMovie(movie);
                } catch (error) {
                    console.error("Error:", error);
                    showError(error.message);
                }
            }

            function renderMovie(movie) {
                const detailsSection = document.getElementById("movie-details");
                detailsSection.innerHTML = `
                    <img id="movie-poster" src="${movie.poster || 'https://via.placeholder.com/400x600?text=No+Poster'}" 
                         alt="${movie.title}" 
                         class="movie-poster-large"
                         onerror="this.src='https://via.placeholder.com/400x600?text=Poster+Not+Available'">
                    <div class="movie-info">
                        <h1 id="movie-title">${movie.title || 'Untitled Movie'}</h1>
                        <p id="movie-year"><strong>Year:</strong> ${movie.year || 'N/A'}</p>
                        <p id="movie-genre"><strong>Genre:</strong> ${movie.genre || 'Not specified'}</p>
                        <p id="movie-description"><strong>Description:</strong> ${movie.description || 'No description available.'}</p>
                        <div class="buttons">
                            ${movie.streamlink ? `<a href="${movie.streamlink}" target="_blank" class="stream-btn">Stream Now</a>` : ''}
                            ${movie.downloadlink ? `<a href="${movie.downloadlink}" target="_blank" class="download-btn">Download</a>` : ''}
                        </div>
                    </div>
                `;
            }

            function showError(message) {
                document.getElementById("movie-details").innerHTML = `
                    <div class="error-state">
                        <h2>Oops! Something went wrong</h2>
                        <p>${message}</p>
                        <a href="index.html" class="back-btn">‚Üê Back to Home</a>
                    </div>
                `;
            }

            fetchMovieDetails();
        });
    </script>
</body>
</html>
